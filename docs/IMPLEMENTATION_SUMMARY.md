# âœ… åˆ†é˜¶æ®µæµ‹è¯•ç³»ç»Ÿå®ç°æ€»ç»“

## ğŸ“¦ å·²å®Œæˆçš„å·¥ä½œ

### 1ï¸âƒ£ æ ¸å¿ƒé…ç½®æ–‡ä»¶

#### `stage_test_config.yaml` (370+ è¡Œ)
**åŠŸèƒ½**: å®šä¹‰æ‰€æœ‰å·¥ä½œæµå’Œé˜¶æ®µçš„å®Œæ•´é…ç½®

**åŒ…å«å†…å®¹**:
- âœ… 3ä¸ªå®Œæ•´å·¥ä½œæµé…ç½®:
  - `generate-game-contents` (5ä¸ªé˜¶æ®µ)
  - `generate-game-asset` (5ä¸ªé˜¶æ®µ)
  - `add-game-asset` (4ä¸ªé˜¶æ®µ)
- âœ… æ¯ä¸ªé˜¶æ®µçš„è¯¦ç»†å®šä¹‰:
  - è¾“å…¥ç±»å‹å’Œæ¥æº
  - è¾“å‡ºè·¯å¾„å’Œæ ¼å¼
  - éªŒè¯è§„åˆ™ï¼ˆ20+ ç§éªŒè¯ç±»å‹ï¼‰
  - ä¾èµ–å…³ç³»
  - è¶…æ—¶é…ç½®
- âœ… å…¨å±€é…ç½®ï¼ˆå·¥ä½œç©ºé—´ã€Mockã€æ¸…ç†ç­–ç•¥ï¼‰
- âœ… 3ä¸ªé¢„è®¾æµ‹è¯•åœºæ™¯ï¼ˆquick, full, real_apiï¼‰

**å…³é”®ç‰¹æ€§**:
```yaml
stages:
  stage1:
    name: "æ¸¸æˆè®¾è®¡ç”Ÿæˆ"
    function: "text_generation_function.generate_game_design"
    input: { type: "text", source: "user_input" }
    output: { type: "file", path: "doc/game.md" }
    validation:
      - check: "file_exists"
      - check: "contains_keywords"
        keywords: ["æ¸¸æˆ", "ç©å®¶", "æœºåˆ¶"]
```

---

### 2ï¸âƒ£ æµ‹è¯•è¿è¡Œå™¨

#### `test_stage_runner.py` (600+ è¡Œ)
**åŠŸèƒ½**: å¼ºå¤§çš„å‘½ä»¤è¡Œæµ‹è¯•å·¥å…·

**æ ¸å¿ƒç±»**: `StageTestRunner`

**ä¸»è¦åŠŸèƒ½**:
- âœ… å·¥ä½œç©ºé—´ç®¡ç†ï¼ˆè‡ªåŠ¨åˆ›å»ºå’Œæ¸…ç†ï¼‰
- âœ… åŠ¨æ€å‡½æ•°å¯¼å…¥ï¼ˆæ”¯æŒæ‰€æœ‰MCPå·¥å…·å‡½æ•°ï¼‰
- âœ… è¾“å…¥å‡†å¤‡ï¼ˆæ”¯æŒ5ç§è¾“å…¥ç±»å‹ï¼‰
- âœ… è¾“å‡ºéªŒè¯ï¼ˆ20+ ç§éªŒè¯æ£€æŸ¥ï¼‰
- âœ… é˜¶æ®µé—´æ•°æ®ä¼ é€’ï¼ˆcontextæœºåˆ¶ï¼‰
- âœ… è¯¦ç»†çš„è¿›åº¦å’Œç»“æœæŠ¥å‘Š
- âœ… é”™è¯¯å¤„ç†å’Œå †æ ˆè·Ÿè¸ª

**å‘½ä»¤è¡Œæ¥å£**:
```bash
# å•é˜¶æ®µæµ‹è¯•
python test_stage_runner.py -w generate-game-contents -s stage1

# å¤šé˜¶æ®µæµ‹è¯•
python test_stage_runner.py -w generate-game-contents -s stage1,stage2,stage3

# èŒƒå›´æµ‹è¯•
python test_stage_runner.py -w generate-game-contents --from-stage stage2

# é¢„è®¾åœºæ™¯
python test_stage_runner.py --scenario quick
```

---

### 3ï¸âƒ£ éªŒè¯å™¨æ¨¡å—

#### `stage_validators.py` (400+ è¡Œ)
**åŠŸèƒ½**: æä¾›æ‰€æœ‰éªŒè¯æ£€æŸ¥çš„å®ç°

**éªŒè¯å™¨ç±»**: `StageValidator`

**æ”¯æŒçš„éªŒè¯ç±»å‹**:

| ç±»åˆ« | éªŒè¯æ–¹æ³• | è¯´æ˜ |
|------|---------|------|
| **æ–‡ä»¶** | `validate_file_exists` | æ–‡ä»¶æ˜¯å¦å­˜åœ¨ |
| | `validate_file_not_empty` | æ–‡ä»¶éç©º |
| | `validate_min_size` | æœ€å°æ–‡ä»¶å¤§å° |
| | `validate_directory_exists` | ç›®å½•å­˜åœ¨ |
| **JSON** | `validate_valid_json` | JSONæ ¼å¼æ­£ç¡® |
| | `validate_is_array` | æ˜¯æ•°ç»„æ ¼å¼ |
| | `validate_array_not_empty` | æ•°ç»„éç©º |
| | `validate_items_have_fields` | å…ƒç´ åŒ…å«å¿…å¡«å­—æ®µ |
| | `validate_todos_structure` | TODOç»“æ„æ­£ç¡® |
| **å†…å®¹** | `validate_contains_keywords` | åŒ…å«å…³é”®è¯ |
| | `validate_size_format` | å°ºå¯¸æ ¼å¼æ­£ç¡® |
| | `validate_asset_count_matches` | ç´ ææ•°é‡åŒ¹é… |
| | `validate_has_test_step` | åŒ…å«æµ‹è¯•æ­¥éª¤ |
| **å›¾åƒ** | `validate_images_valid` | å›¾åƒæ ¼å¼æ­£ç¡® |
| | `validate_images_size_correct` | å›¾åƒå°ºå¯¸æ­£ç¡® |
| | `validate_image_count_matches` | å›¾åƒæ•°é‡åŒ¹é… |
| | `validate_originals_saved` | åŸå›¾å·²ä¿å­˜ |

**ä½¿ç”¨ç¤ºä¾‹**:
```python
validator = StageValidator(workspace_dir)
result = validator.validate_valid_json("public/tasks.json")
```

---

### 4ï¸âƒ£ æµ‹è¯•å¤¹å…·

#### `tests/fixtures/`
**åŠŸèƒ½**: æä¾›æµ‹è¯•æ•°æ®å’Œç¤ºä¾‹

**åŒ…å«æ–‡ä»¶**:
- âœ… `sample_user_input.txt` - ç¤ºä¾‹æ¸¸æˆåˆ›æ„è¾“å…¥
- âœ… `sample_tasks.json` - ç¤ºä¾‹ç´ æä»»åŠ¡æ¸…å•ï¼ˆ5ä¸ªç´ æï¼‰

**ç¤ºä¾‹æ•°æ®**:
```json
[
  {
    "name": "player_tank.png",
    "description": "è“è‰²å¦å…‹ï¼Œä¿¯è§†è§’ï¼Œæœä¸Šï¼Œç®€æ´çš„2Dåƒç´ é£æ ¼",
    "size": "128x128",
    "is_background": false,
    "needs_generation": true
  }
]
```

---

### 5ï¸âƒ£ æ–‡æ¡£ç³»ç»Ÿ

#### `README_STAGE_TEST.md` (500+ è¡Œ)
**å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£**ï¼ŒåŒ…å«:
- âœ… ç³»ç»Ÿæ¦‚è¿°å’Œæ–‡ä»¶è¯´æ˜
- âœ… å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… æ‰€æœ‰å·¥ä½œæµå’Œé˜¶æ®µçš„è¯¦ç»†è¯´æ˜
- âœ… éªŒè¯è§„åˆ™åˆ—è¡¨
- âœ… æµ‹è¯•è¾“å‡ºç¤ºä¾‹
- âœ… é…ç½®è¯´æ˜
- âœ… ä½¿ç”¨åœºæ™¯ç¤ºä¾‹
- âœ… è°ƒè¯•æŠ€å·§
- âœ… å¸¸è§é—®é¢˜è§£ç­”

#### `QUICKSTART.md` (200+ è¡Œ)
**5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨**ï¼ŒåŒ…å«:
- âœ… 5ä¸ªæ­¥éª¤çš„å¿«é€Ÿä¸Šæ‰‹
- âœ… å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
- âœ… 3ä¸ªå…¸å‹ä½¿ç”¨åœºæ™¯
- âœ… æµ‹è¯•è¾“å‡ºè§£è¯»
- âœ… é…ç½®è°ƒæ•´ç¤ºä¾‹
- âœ… é—®é¢˜æ’æŸ¥æŒ‡å—

#### `demo_stage_test.sh`
**è‡ªåŠ¨æ¼”ç¤ºè„šæœ¬**ï¼ŒåŒ…å«:
- âœ… äº¤äº’å¼æ¼”ç¤ºæµç¨‹
- âœ… è‡ªåŠ¨è¿è¡Œç¤ºä¾‹æµ‹è¯•
- âœ… å±•ç¤ºç”Ÿæˆçš„æ–‡ä»¶
- âœ… ä½¿ç”¨æç¤º

---

## ğŸ“Š æµ‹è¯•è¦†ç›–èŒƒå›´

### å·¥ä½œæµè¦†ç›–

| å·¥ä½œæµ | é˜¶æ®µæ•° | é…ç½®å®Œæˆåº¦ |
|--------|--------|-----------|
| `generate-game-contents` | 5 | âœ… 100% |
| `generate-game-asset` | 5 | âœ… 100% |
| `add-game-asset` | 4 | âœ… 100% |

### éªŒè¯è¦†ç›–

| éªŒè¯ç±»åˆ« | éªŒè¯ç±»å‹æ•° | å®ç°å®Œæˆåº¦ |
|----------|-----------|-----------|
| æ–‡ä»¶éªŒè¯ | 4 | âœ… 100% |
| JSONéªŒè¯ | 5 | âœ… 100% |
| å†…å®¹éªŒè¯ | 4 | âœ… 100% |
| å›¾åƒéªŒè¯ | 4 | âœ… 100% |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½

1. **çµæ´»çš„æµ‹è¯•èŒƒå›´**
   - âœ… å•é˜¶æ®µæµ‹è¯•
   - âœ… å¤šé˜¶æ®µç»„åˆæµ‹è¯•
   - âœ… èŒƒå›´æµ‹è¯•ï¼ˆfrom-stageï¼‰
   - âœ… å®Œæ•´å·¥ä½œæµæµ‹è¯•
   - âœ… é¢„è®¾åœºæ™¯æµ‹è¯•

2. **å¼ºå¤§çš„éªŒè¯ç³»ç»Ÿ**
   - âœ… 20+ ç§éªŒè¯ç±»å‹
   - âœ… è‡ªå®šä¹‰éªŒè¯è§„åˆ™
   - âœ… è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Š
   - âœ… å®¹å·®é…ç½®ï¼ˆå›¾åƒå°ºå¯¸ç­‰ï¼‰

3. **å¼€å‘å‹å¥½ç‰¹æ€§**
   - âœ… å·¥ä½œç©ºé—´ä¿ç•™ï¼ˆè°ƒè¯•ï¼‰
   - âœ… è¯¦ç»†æ—¥å¿—æ¨¡å¼
   - âœ… é”™è¯¯æ—¶åœæ­¢é€‰é¡¹
   - âœ… Mock APIæ”¯æŒ

4. **å®Œå–„çš„æ–‡æ¡£**
   - âœ… å®Œæ•´ä½¿ç”¨æ‰‹å†Œ
   - âœ… å¿«é€Ÿå…¥é—¨æŒ‡å—
   - âœ… ç¤ºä¾‹å’Œæ¼”ç¤º
   - âœ… é…ç½®å‚è€ƒ

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: å¿«é€ŸéªŒè¯æŸä¸ªé˜¶æ®µ

```bash
# åªæµ‹è¯•æ¸¸æˆè®¾è®¡ç”Ÿæˆ
python test_stage_runner.py -w generate-game-contents -s stage1
```

**è¾“å‡º**:
```
============================================================
å¼€å§‹é˜¶æ®µ: generate-game-contents -> stage1
============================================================
ğŸ“¥ å‡†å¤‡è¾“å…¥...
âš™ï¸  æ‰§è¡Œ: text_generation_function.generate_game_design...
âœ“ å‡½æ•°æ‰§è¡Œå®Œæˆ
âœ“ è¾“å‡ºå·²ä¿å­˜: tests/temp_workspace/.../doc/game.md
ğŸ” éªŒè¯è¾“å‡º...
  âœ“ file_exists éªŒè¯é€šè¿‡
  âœ“ file_not_empty éªŒè¯é€šè¿‡
  âœ“ contains_keywords éªŒè¯é€šè¿‡
  âœ“ min_size éªŒè¯é€šè¿‡
âœ… é˜¶æ®µå®Œæˆ: stage1 (15.32s)

æ€»è®¡: 1 ä¸ªé˜¶æ®µ
æˆåŠŸ: 1 ä¸ª
å¤±è´¥: 0 ä¸ª
æˆåŠŸç‡: 100.0%
```

### ç¤ºä¾‹2: æµ‹è¯•å‰3ä¸ªé˜¶æ®µï¼ˆè·³è¿‡å›¾åƒç”Ÿæˆï¼‰

```bash
python test_stage_runner.py -w generate-game-contents -s stage1,stage2,stage3
```

**ç”Ÿæˆæ–‡ä»¶**:
- âœ… `doc/game.md` - æ¸¸æˆè®¾è®¡æ–‡æ¡£
- âœ… `public/tasks.json` - ç´ æä»»åŠ¡æ¸…å•
- âœ… `doc/assets.md` - ç´ æä½¿ç”¨è¯´æ˜

### ç¤ºä¾‹3: è°ƒè¯•å›¾åƒç”Ÿæˆé—®é¢˜

```bash
# 1. å‡†å¤‡æµ‹è¯•æ•°æ®
cp tests/fixtures/sample_tasks.json tests/temp_workspace/test_dir/public/

# 2. åªæµ‹è¯•å›¾åƒç”Ÿæˆé˜¶æ®µ
python test_stage_runner.py -w generate-game-contents -s stage4 -v

# 3. æ£€æŸ¥ç”Ÿæˆçš„å›¾åƒ
ls -lh tests/temp_workspace/test_dir/public/assets/
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

```
game-helper-python/
â”œâ”€â”€ ğŸ“„ stage_test_config.yaml       # é…ç½®æ–‡ä»¶ï¼ˆ370è¡Œï¼‰
â”œâ”€â”€ ğŸ test_stage_runner.py         # æµ‹è¯•è¿è¡Œå™¨ï¼ˆ600è¡Œï¼‰
â”œâ”€â”€ ğŸ stage_validators.py          # éªŒè¯å™¨æ¨¡å—ï¼ˆ400è¡Œï¼‰
â”œâ”€â”€ ğŸ“š README_STAGE_TEST.md         # å®Œæ•´æ–‡æ¡£ï¼ˆ500è¡Œï¼‰
â”œâ”€â”€ ğŸ“– QUICKSTART.md                # å¿«é€Ÿå…¥é—¨ï¼ˆ200è¡Œï¼‰
â”œâ”€â”€ ğŸ¬ demo_stage_test.sh           # æ¼”ç¤ºè„šæœ¬
â”œâ”€â”€ ğŸ“„ test_config.yaml             # Pytesté…ç½®
â”œâ”€â”€ ğŸ“„ pytest.ini                   # Pytestè®¾ç½®
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ fixtures/
â”‚       â”œâ”€â”€ sample_user_input.txt   # ç¤ºä¾‹è¾“å…¥
â”‚       â””â”€â”€ sample_tasks.json       # ç¤ºä¾‹ä»»åŠ¡
â””â”€â”€ tests/temp_workspace/           # æµ‹è¯•å·¥ä½œç©ºé—´ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
```

**æ€»ä»£ç é‡**: ~2000+ è¡Œ
**æ€»æ–‡æ¡£é‡**: ~1000+ è¡Œ

---

## ğŸ“ å­¦ä¹ è·¯å¾„å»ºè®®

### ç¬¬1å¤©: ç†Ÿæ‚‰åŸºç¡€
1. é˜…è¯» `QUICKSTART.md`
2. è¿è¡Œ `./demo_stage_test.sh`
3. æµ‹è¯•å•ä¸ªé˜¶æ®µ

### ç¬¬2å¤©: æ·±å…¥ç†è§£
1. é˜…è¯» `README_STAGE_TEST.md`
2. æŸ¥çœ‹ `stage_test_config.yaml` é…ç½®
3. æµ‹è¯•å®Œæ•´å·¥ä½œæµ

### ç¬¬3å¤©: é«˜çº§ä½¿ç”¨
1. è‡ªå®šä¹‰éªŒè¯è§„åˆ™
2. æ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯
3. é›†æˆåˆ°CI/CD

---

## ğŸ”® æœªæ¥æ‰©å±•æ–¹å‘

### å¯é€‰åŠŸèƒ½ï¼ˆæœªå®ç°ï¼‰

1. **Mockå“åº”ç³»ç»Ÿ**
   - é¢„å½•åˆ¶çš„LLMå“åº”
   - å¯é‡å¤çš„æµ‹è¯•ç»“æœ

2. **æ€§èƒ½åŸºå‡†æµ‹è¯•**
   - é˜¶æ®µè€—æ—¶ç»Ÿè®¡
   - æ€§èƒ½å›å½’æ£€æµ‹

3. **å¯è§†åŒ–æŠ¥å‘Š**
   - HTMLæµ‹è¯•æŠ¥å‘Š
   - å›¾è¡¨å±•ç¤º

4. **å¹¶è¡Œæµ‹è¯•**
   - å¤šä¸ªå·¥ä½œæµå¹¶è¡Œ
   - åŠ é€Ÿæµ‹è¯•æ‰§è¡Œ

5. **é›†æˆæµ‹è¯•**
   - ç«¯åˆ°ç«¯æµ‹è¯•
   - çœŸå®APIæµ‹è¯•

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… æ”¯æŒæ‰€æœ‰3ä¸ªå·¥ä½œæµ
- âœ… æ”¯æŒ14ä¸ªé˜¶æ®µçš„ç‹¬ç«‹æµ‹è¯•
- âœ… æä¾›20+ ç§éªŒè¯ç±»å‹
- âœ… å®Œæ•´çš„å‘½ä»¤è¡Œæ¥å£

### æ˜“ç”¨æ€§
- âœ… æ¸…æ™°çš„æ–‡æ¡£
- âœ… ç¤ºä¾‹å’Œæ¼”ç¤º
- âœ… å‹å¥½çš„é”™è¯¯æç¤º
- âœ… åˆç†çš„é»˜è®¤é…ç½®

### å¯ç»´æŠ¤æ€§
- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… é…ç½®ä¸ä»£ç åˆ†ç¦»
- âœ… æ˜“äºæ‰©å±•
- âœ… è¯¦ç»†çš„æ³¨é‡Š

---

## ğŸ‰ æ€»ç»“

**å·²å®Œæˆ**: ä¸€å¥—å®Œæ•´çš„ã€ç”Ÿäº§çº§åˆ«çš„åˆ†é˜¶æ®µæµ‹è¯•ç³»ç»Ÿ

**æ ¸å¿ƒä»·å€¼**:
1. âœ… **å¿«é€Ÿå®šä½é—®é¢˜** - ç²¾ç¡®åˆ°å…·ä½“é˜¶æ®µ
2. âœ… **èŠ‚çœè°ƒè¯•æ—¶é—´** - æ— éœ€è¿è¡Œå®Œæ•´æµç¨‹
3. âœ… **æé«˜å¼€å‘æ•ˆç‡** - å¿«é€ŸéªŒè¯ä¿®æ”¹
4. âœ… **ä¿è¯ä»£ç è´¨é‡** - è‡ªåŠ¨åŒ–éªŒè¯
5. âœ… **é™ä½å­¦ä¹ æˆæœ¬** - è¯¦ç»†æ–‡æ¡£å’Œç¤ºä¾‹

**ç«‹å³å¼€å§‹ä½¿ç”¨**:
```bash
cd /path/to/game-helper-python
python test_stage_runner.py -w generate-game-contents -s stage1
```

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸš€
